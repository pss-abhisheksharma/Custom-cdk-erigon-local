# DATASTREAM FORMAT

The format of the data in the data stream is defined using protobuf. Latest version can always be found here. This document describes them as they are in the date of creation of the document.

## Entry types

### BookMark

​​​​- Type

​​​​- Value

**Notes**
There are bookmarks for Batches (type = 1) and L2Blocks (type = 2).

### BatchStart

​​​​- Number

​​​​- Type

​​​​- ForkID

​​​​- ChainID

​​​​- Debug

**Notes**

* ForkID is 0 for genesis batch

* Type can be:

   - Regular: For normal batches

   - Forced: For forced batches

   - Injected: Batch 1 of a network with ForkID >= 7. It is generated by the smart contract during network creation.


### L2Block

​​​​- Number

​​​​- BatchNumber

​​​​- Timestamp

​​​​- DeltaTimestamp

​​​​- MinTimestamp

​​​​- L1BlockHash

​​​​- L1InfoTreeIndex

​​​​- Hash (BlockHash)

​​​​- StateRoot

​​​​- GlobalExitRoot

​​​​- Coinbase

​​​​- BlockGasLimit

​​​​- BlockInfoRoot

- StateRoot

​​​​- Debug

### L2BlockEnd

​​​​- Number

**Notes**

* **Hash** - hash calculated by the node and used in the RPC

* **StateRoot** 

  - Final state root of the L2Block (For ForkIDs < 7: see also *IntermediateStateRoot* in *L1Transacton*)

* **L1BlockHash**

     - For ForkIDs >= 7
  
       - For regular batches: ParentHash of the L1 block when the GER was inserted in the L1InfoTree

       - If batch is Forced or Injected: BlockHash of the parent L1 block when the forced or injected happen in L1
      
     - For ForkIDs < 7: 0x00...000, unused.

* **DeltaTimestamp**: difference between current and previous block timestamps

* **MinTimestamp**: L1InfoTree contains: GER, L1BlockHash and minTimeStamp

  - For ForkID >= 7: Timestamp of the block containing the block info tree update.
  
  - For ForkID < 7: 0

  - For Genesis block: 0

* **BlockGasLimit**: Currently unused (set to 0)

* **BlockInfoRoot**:

  - For ForkIDs >= 7: actual BlockInfoRoot

  - For ForkIDs < 7: 0x000…00,unused 

### Transaction

​​​​- L2BlockNumber

​​​​- Index

​​​​- IsValid

​​​​- Encoded

​​​​- EffectiveGasPricePercentage

​​​​- IntermediateStateRoot

​​​​- Debug

**Notes**

* EffectiveGasPricePercentage: Only available for ForkIDs >= 5, 0 in other ForkIDs.

* IntermediateStateRoot: 

   - ForkIDs <= 7: is the resulting SR_A of the TX execution, previous to storing it in the system SC and so getting a new SR_B.
 
   - ForkIDs > 7: 0x0..0, unused

### UpdateGER

​​​​- BatchNumber

​​​​- Timestamp

​​​​- GlobalExitRoot

​​​​- Coinbase

​​​​- ForkID

​​​​- ChainID

​​​​- StateRoot

​​​​- Debug

**Notes**

UpdateGER is only needed for ForkID < 7. It is used to signal a change in the GER for batches without Transactions (and without L2Blocks), since an empty batch changes the SR.

### BatchEnd

​​​​- Number
​​​​- LocalExitRoot
​​​​- StateRoot
​​​​- Debug
Expected Entries Order

```
[BatchBookMark]
[BatchStart]
[L2BlockBookMark]
[L2Block]
[Transaction]
[Transaction]
[…]
[Transaction]
[L2BlockBookMark]
[L2Block2]
[Transaction]
[Transaction]
[…]
[Transaction]
[…]
[L2Block2End]
[L2BlockBookMark]
[L2Block]
[…]
[L2Block2End]
[BatchEnd]
[BatchBookMark]
[BatchStart]
[L2BlockBookMark]
[…]
```

### Fork ID names

- BLUEBERRY = 4
- DRAGONFRUIT = 5
- INCABERRY = 6
- ETROG = 7
- ELDERBERRY = 8
- ELDELBERRY_2 = 9
